# Design-Doc: Чат-бот / RAG-система  

## 1. Контекст проекта  
### 1.1 Бизнес-задача
#### Исходное состояние
На текущий момент консультации абитуриентов по программам бакалавриата НИУ ВШЭ осуществляются через сайт, email, телефон, FAQ-бота в Telegram и другие социальные сети. Специализированный чат-бот, обеспечивающий единый доступ к полной официальной информации по программам бакалавриата всех кампусов, способный качественно проконсультировать абитуриента фактически отсутствует.

#### Описание проблемы
Ключевые проблемы текущего процесса консультирования абитуриентов:

- высокая нагрузка на каналы консультаций в период приёмной кампании из‑за большого числа повторяющихся вопросов (касаемо сроков, документов, требований к абитуриаету, стоимости обучения и правил поступления)
- данные распределены по множеству страниц и документов, из-за чего пользователю приходится вручную собирать ответ из фрагментов
- присутствует риск ошибки со стороны абитуриента из‑за пропуска обновлений (изменения правил, сроков, планов приёма) или неверной интерпретации информации, изложенной в официальных документах

**Предлагаемое решение:** чат‑бота на основе Retrieval‑Augmented Generation (RAG), предоставляющий консультационные ответы по поступлению и содержанию программ бакалавриата НИУ ВШЭ, опираясь на официальные источники (сайт бакалавриата НИУ ВШЭ), бот извлекает из них релевантные фрагменты и возвращает ответы с ссылками на первоисточники.

Реализации опирается именно на RAG-решение, так как:
- все нужные для первичной консультации документы уже опубликованы на официальном сайте бакалавриата НИУ ВШЭ, что обуславливает именно извлечение и структуризацию информации, а не ее формальную генерацию
- RAG позволяет формировать ответы на основе извлечённых фрагментов с обязательными ссылками на официальный источник, отчего снижается риск галлюцинаций, повышая доверие
- обновление знаний чат-бота достикается обновлением базы данных без повторного обучения модели, что легко сочетается с циклами приемной кампании
- интерфейс в виде Telegram в рамках целевой аудитории обеспечивает быстрый и комфортный текстовый доступ

#### Критерии успеха (пока не фиксирую тут конкретные значения, нужно обсудить)

На уровне прототипа критерии успеха целесообразно разделить на два блока:  
- критерии качества RAG‑модели  
- критерии успешности решения бизнес‑задачи

Для первого блока логично взять:
- долю коректных ответов относительно фактических данных в них (корректность описания, сроков, баллов, минимальных требований, стоимости и тд.) на золотом наборе
- среднее время ответа (retrieval + generation) в целевой инфраструктуре

Для второго же:
- доля запросов, которые бот закрывает без перенаправления в приёмную комиссию и/или учебный офис
- доля случаев, когда пользователь не обращается повторно с тем же вопросом в течение заданного периода (например, суток или недели), что интерпретируется как достаточность ответа бота
- (возможно добавить оценку полезности пользователями по шкале)

### 1.2 Целевая аудитория и пользователи  
#### Основные пользователи

- абитуриенты программ бакалавриата НИУ ВШЭ всех кампусов (Москва, Санкт‑Петербург, Нижний Новгород, Пермь)
- родители и законные представители абитуриентов

#### Основные сценарии использования

- **Одношаговые вопросы:** какие экзамены требуются, каковы сроки приёма, какая стоимость обучения, какие документы нужны, сколько бюджетных/платных мест
- **Вопросы с контекстом:** различия между программами (по содержанию и условиям поступления), уточнения по конкретной программе и кампусу, уточнения по основаниям и формам обучения
- **Развёрнутые описания:** структура учебного плана, основные дисциплины по курсам/семестрам, возможные специализации
- **Запросы вне предметной области бота:** честный вежливый отказ

#### Категории ошибок

- **критические ошибки:**
  - неверная информация о крайних сроках подачи документов, дате начала приёма, требованиях к обязательным документам
  - некорректные утверждения о формальных условиях приёма
Ответы на запросы, ожидающие в качестве ответа подобную информацию корректным поведением должны содержать либо полностью корректный ответ, либо отказ с переадресацией на официальный документ/веб-сайт/контакт в исключительных случаях

- **нежелательные ошибки:**
  - неполное перечисление альтернативных траекторий или вариантов программ при подборе по интересам
  - неточные или не до конца подробные и понятные описания содержания учебного плана при корректных ссылках на официальный документ

- **допустимо в рамках прототипа:**
  - отсутствие ответа при недостаточном контексте (бот явно об этом сообщает)
  - дублирование информации, имеющейся на сайте, без добавления какой-либо аналитики

### 1.3 Ограничения и допущения  
#### Функциональные ограничения
- чат-бот выполняет только функции консультирования и не выполняет юридически значимых действий
- чат-бот не интегрируется с ЛК абитуриета и внутренними системами НИУ ВШЭ

#### Допущения по части данных
- база знаний строится исключительно на официальных публичных источниках НИУ ВШЭ (веб-сайт бакалавриата НИУ ВШЭ, а также прикрепленные PDF-документы)
- изменения в правилах приёма и параметрах программ происходят пакетно (согласно внутренним циклам обновления)
- допускается использовать исторические данные как ориентировочные (с явной пометкой)

#### Допущения по части инфраструктуры (TBD)

#### Риски и способы снижения
В рамках прототипа ожидаемыми рисками являются галлюцинации модели, ошибки парсинга, инъекции, попытки выхода за домент, а также устаревание данных.

Способы снижения этих рисков следующие:
- строгие системные инструкции, генерация только при наличии достаточно релевантного контекста, отказ при недостаточности данных и обязательные ссылки на источники 
- риски ошибок парсинга снижает выборочная ручная проверка критичных документов
- для борьбы с выдаей устаревших данных требуется привязка фрагментов к году приёмной кампании (метаданные), периодическая переиндексация, а также явное указание года в ответах 
- риски инъекций и выхода за домен снижает фильтрация запросов и шаблоны отказа с переадресацией, приоритет системного промпта над пользовательскими инструкциями

## 2. Архитектура решения  
### 2.1 Общая схема  
-  
-  

### 2.2 Хранилище знаний / документооборот  
-  
-  
-  

### 2.3 Retrieval + Generation  
-  
-  
-  

### 2.4 Интеграции и интерфейсы  
-  
-  

### 2.5 Инфраструктура и развертывание  
-  
-  
-  

## 3. Данные и качество знаний  
### 3.1 Сбор и предобработка данных  
#### Источники данных

**Основные домены:**
- `ba.hse.ru` — главный портал абитуриентов бакалавриата (общие правила приёма, сроки, FAQ, инструкции)
- `www.hse.ru/ba/*` — страницы программ бакалавриата (описание, требования, учебные планы)
- `admissions.hse.ru` — раздел приёмной комиссии (подача документов, статистика, календарь приёма)
- `spb.hse.ru/ba/*`, `nn.hse.ru/ba/*`, `perm.hse.ru/ba/*` — кампусные разделы с локальными особенностями приёма

**Типы источников:**

1. **HTML‑страницы программ:**
   - Главная страница программы: краткое описание, ключевые особенности
   - `/admission` — требования к ЕГЭ, минимальные баллы, документы, стоимость, сроки, количество мест
   - `/about` — содержание программы, специализации, траектории
   - `/documents` — официальные документы программы, учебные планы

2. **HTML‑разделы:**
   - `ba.hse.ru/rules` — правила приёма (порядок подачи, конкурсные группы, приоритеты)
   - `ba.hse.ru/faq` — FAQ
   - `ba.hse.ru/calendar` — календарь приёмной кампании (сроки подачи, зачисления, апелляций)
   - Таблицы: минимальные баллы по программам и кампусам, количество мест, проходные баллы прошлых лет

3. **PDF‑документы:**
   - Правила приёма НИУ ВШЭ (регламентн)
   - Справочник программ бакалавриата (сводная таблица по всем программам: минимальные баллы, количество мест, стоимость)
   - Учебные планы

#### Шаги предобработки (TBD)
1. HTML:
  - извлечение контента среди навигации и служебных блоков с сохранением структуры
  - преобразование таблиц в JSON
  - нормализация текста и числовых значений
2. PDF:
 - 
3. Чанкинг:
 - рекурсивный с оверлапом


#### Метаданные (пока пример)

Для всех чанков:
```json
{
  "doc_id": "ba_rules_2025",
  "chunk_id": "ba_rules_2025_chunk_042",
  "source_url": "https://ba.hse.ru/rules",
  "source_type": "html | pdf",
  "retrieved_at": "2026-01-12T10:00:00Z",
  "hash": "sha256:abc123def456...",
  "language": "ru",
  "content_type": "rules | admission | requirements | fees | timeline | documents | curriculum | faq",
  "admission_year": 2025,
  "priority": "[5, 4, 3, 2, 1]"
}
```

Для программы обучения:
```json
{
  "program_id": "09.03.04",
  "program_name": "Программная инженерия",
  "program_specializations": ["Backend", "DevOps"],
  "campus": "moscow"
}
```

Параметры поступления:
```json
{
  "exam_subjects": ["математика", "русский язык", "информатика"],
  "exam_type": "ege | olympiad",
  "education_form": ["full_time", "part_time"],
  "funding_basis": ["budget", "paid"],
  "quota_types": [""]
}
```

### 3.2 Векторизация и индексирование  
-  
-  
-  

### 3.3 Метрики качества знаний  
-  
-  
-  

## 4. Модель и генерация  
### 4.1 Выбор LLM и промптинг  
-  
-  
-  

### 4.2 Контроль качества ответов  
-  
-  
-  

### 4.3 Обучение/дообучение  
-  
-  
-  

## 5. UX / пользовательский опыт  
### 5.1 Сценарии взаимодействия  
-  
-  
-  

### 5.2 Диалоговая логика  
-  
-  
-  

### 5.3 Метрики UX  
-  
-  
-  

## 6. Безопасность, соответствие и этика

#### Обработка персональных данных

- пользовательские сообщения и идентификаторы Telegram являются потенциальными персональные данными, `telegram_id` не хранится в открытом виде, используется `id` сессии

#### Прозрачность

- в начаде работы бот явно обозначается как автоматизированная система, объясняется, что ответы опираются на официальные материалы ВШЭ
- политика логирования описывает, какие данные хранятся, зачем и как долго

#### Этические принципы и стиль общения

- бот не допускает дискриминационных формулировок, поддерживает единые правила для всех кампусов и программ
- бот не дает гарантий поступления и не оценивает шансы, бот только консультирует, предоставляя официальную статистику с указанием периода
- стиль нейтральный, вежливый, деловой, бот не поддерживает в своих формулировках шутки, сленг, избегает оцеки качества программ и политики университета, не делает никаких заявлений от имени университета

## 7. План внедрения и эксплуатации  
### 7.1 Этапы проекта  
-  
-  
-  

### 7.2 Поддержка и эксплуатация  
-  
-  
-  

## 8. Риски и допущения  
-  
-  
-  
-  

## 9. Бюджет и ресурсы  
- Человеческие ресурсы:  
  -  
- Технологические ресурсы:  
  -  
- Примерные затраты:  
  -  
- ROI оценки:  
  -  

## 10. Приложения  
- Словарь терминов и аббревиатур  
- Ссылки на специфические документы  
- Диаграммы, схемы, mock-up интерфейсы  
- Чек-лист готовности к запуску  